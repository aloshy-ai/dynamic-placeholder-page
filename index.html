<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Placeholder Page | aloshy.ðŸ…°ðŸ…¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
            font-family: Arial, sans-serif;
        }

        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            object-fit: cover;
            transition: opacity 2s ease-in-out;
            animation: kenBurns 20s ease-in-out infinite alternate;
            animation-play-state: paused;
        }

        .background.active {
            opacity: 1;
            animation-play-state: running;
        }

        @keyframes kenBurns {
            0% {
                transform: scale(1) translate(0, 0);
            }
            25% {
                transform: scale(1.05) translate(-1%, -1%);
            }
            75% {
                transform: scale(1.08) translate(1%, 1%);
            }
            100% {
                transform: scale(1.12) rotate(1deg);
            }
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                rgba(255, 100, 100, 0.6),
                rgba(100, 100, 255, 0.6),
                rgba(100, 255, 100, 0.6),
                rgba(255, 100, 100, 0.6),
                rgba(100, 100, 255, 0.6)
            );
            mix-blend-mode: overlay;
            animation: gradientFlow 8s linear infinite;
            background-size: 400% 400%;
        }

        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .hostname {
            color: #fff;
            font-weight: bold;
            text-transform: uppercase;
            position: fixed;
            text-align: center;
            white-space: nowrap;
        }

        @media (orientation: portrait) {
            .hostname {
                transform: rotate(-90deg);
            }
        }
    </style>
</head>
<body>
    <div class="background-container">
        <img class="background" alt="Dynamic background">
        <img class="background" alt="Dynamic background">
    </div>
    <div class="overlay"></div>
    <div class="hostname"></div>

    <script>
        const FALLBACK_IMAGE = 'https://www.aloshy.ai/images/bg.png';
        const ROTATION_INTERVAL = 10000; // 10 seconds
        
        let imageCache = [];
        let currentImageIndex = 0;
        let backgrounds = document.querySelectorAll('.background');
        let activeIndex = 0;
        let isTransitioning = false;

        async function fetchImages() {
            try {
                const response = await fetch('https://civitai.com/api/v1/images?limit=8&nsfw=X&sort=Newest', {
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();
                return data.items || [];
            } catch (error) {
                console.warn('Error fetching images:', error);
                return null;
            }
        }

        async function preloadImage(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(url);
                img.onerror = () => reject(new Error('Image load failed'));
                img.src = url;
            });
        }

        async function transition() {
            if (isTransitioning || imageCache.length === 0) return;
            
            try {
                isTransitioning = true;
                const nextIndex = (activeIndex + 1) % 2;
                
                // Get next image URL
                const imageUrl = imageCache[currentImageIndex].url;
                currentImageIndex = (currentImageIndex + 1) % imageCache.length;

                // Preload next image
                await preloadImage(imageUrl);
                
                // Update hostname
                updateHostname();

                // Set up next image
                backgrounds[nextIndex].src = imageUrl;
                
                // Trigger transition
                backgrounds[activeIndex].classList.remove('active');
                backgrounds[nextIndex].classList.add('active');
                
                // Update active index
                activeIndex = nextIndex;
                
                // Reset transition flag after animation completes
                setTimeout(() => {
                    isTransitioning = false;
                }, 2000);
            } catch (error) {
                console.warn('Error during transition:', error);
                isTransitioning = false;
            }
        }

        function showFallback() {
            backgrounds.forEach(bg => {
                bg.src = FALLBACK_IMAGE;
                bg.classList.remove('active');
            });
            backgrounds[0].classList.add('active');
            document.querySelector('.hostname').textContent = 'FALLBACK';
            adjustHostnameSize();
        }

        function adjustHostnameSize() {
            const isPortrait = window.innerHeight > window.innerWidth;
            const targetWidth = isPortrait ? window.innerHeight : window.innerWidth;
            const targetSize = targetWidth * 0.68;
            
            const hostnameEl = document.querySelector('.hostname');
            hostnameEl.style.fontSize = '1px';
            const ratio = targetSize / hostnameEl.offsetWidth;
            hostnameEl.style.fontSize = `${ratio}px`;
        }

        function updateHostname() {
            try {
                const currentUrl = window.location.href;
                const url = new URL(currentUrl);
                document.querySelector('.hostname').textContent = url.hostname.split('.')[0].toUpperCase();
                adjustHostnameSize();
            } catch (error) {
                console.warn('Error updating hostname:', error);
            }
        }

        // Initialize
        (async () => {
            try {
                const fetchedImages = await fetchImages();
                
                // Show fallback only if API failed
                if (!fetchedImages) {
                    showFallback();
                    return;
                }

                // Filter out any invalid URLs and store valid ones
                for (const image of fetchedImages) {
                    try {
                        await preloadImage(image.url);
                        imageCache.push(image);
                    } catch (error) {
                        console.warn('Failed to load image:', image.url);
                    }
                }

                // If no valid images after checking all URLs, show fallback
                if (imageCache.length === 0) {
                    showFallback();
                    return;
                }

                // Set up first image
                const firstImage = imageCache[0];
                backgrounds[0].src = firstImage.url;
                backgrounds[0].classList.add('active');
                
                // Set initial hostname
                updateHostname();

                // Start rotation
                setInterval(transition, ROTATION_INTERVAL);
            } catch (error) {
                console.warn('Error in initialization:', error);
                showFallback();
            }
        })();

        // Handle window resize
        window.addEventListener('resize', adjustHostnameSize);
    </script>
</body>
</html>