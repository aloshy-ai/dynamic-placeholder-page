<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Placeholder Page | aloshy.ðŸ…°ðŸ…¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
            font-family: Arial, sans-serif;
        }

        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            object-fit: cover;
            transition: opacity 2s ease-in-out;
            animation: kenBurns 20s ease-in-out infinite alternate;
            animation-play-state: paused;
        }

        .background.active {
            opacity: 1;
            animation-play-state: running;
        }

        @keyframes kenBurns {
            0% {
                transform: scale(1) translate(0, 0);
            }
            25% {
                transform: scale(1.05) translate(-1%, -1%);
            }
            75% {
                transform: scale(1.08) translate(1%, 1%);
            }
            100% {
                transform: scale(1.12) rotate(1deg);
            }
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                    45deg,
                    rgba(255, 100, 100, 0.6),
                    rgba(100, 100, 255, 0.6),
                    rgba(100, 255, 100, 0.6),
                    rgba(255, 100, 100, 0.6),
                    rgba(100, 100, 255, 0.6)
            );
            mix-blend-mode: overlay;
            animation: gradientFlow 8s linear infinite;
            background-size: 400% 400%;
        }

        @keyframes gradientFlow {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        .credits-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-text {
            display: flex;
            align-items: center;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .credits-link {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.5rem 0.75rem;
            background-color: rgba(31, 41, 55, 0.9);
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s;
            color: rgb(229, 231, 235);
            text-decoration: none;
            font-family: system-ui, -apple-system, sans-serif;
            font-weight: 100;
        }

        .credits-link:hover {
            background-color: rgb(31, 41, 55);
            cursor: pointer;
        }

        .credits-logo {
            height: 0.8rem;
        }

        .logo-text-mono {
            font-family: monospace;
        }

        .logo-text-a {
            color: rgb(239, 68, 68);
        }

        .logo-text-i {
            color: white;
        }
    </style>
</head>
<body>
<div class="background-container">
    <img class="background" alt="Dynamic background">
    <img class="background" alt="Dynamic background">
</div>
<div class="overlay"></div>
<div class="credits-container">
    <div class="logo-section">
        <div class="logo-text">
            <span class="logo-text-mono">aloshy.</span>
            <span class="flex items-center">
                    <span class="logo-text-a">ðŸ…°</span>
                    <span class="logo-text-i">ðŸ…¸</span>
                </span>
        </div>
    </div>
    <div class="credits-banner">
        <a href="https://civitai.com" target="_blank" rel="noopener noreferrer" class="credits-link">
            <span>SOURCE</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 107 22.7" class="credits-logo">
                <defs>
                    <linearGradient id="prideGradient" gradientTransform="rotate(45)">
                        <stop offset="0%" stop-color="#E04A4A"/>
                        <stop offset="20%" stop-color="#E04A4A"/>
                        <stop offset="40%" stop-color="#E0B54A"/>
                        <stop offset="60%" stop-color="#4AE0D4"/>
                        <stop offset="80%" stop-color="#4A6AE0"/>
                        <stop offset="100%" stop-color="#D44AE0"/>
                    </linearGradient>
                </defs>
                <g>
                    <path fill="rgb(229, 231, 235)" d="M20.8,1.7H3.7L1.5,4.1v15l2.3,2.3h17.1v-5.2H6.7V7h14.1V1.7z"/>
                    <path fill="rgb(229, 231, 235)"
                          d="M76.1,1.7H56.6V7h7.2v14.3H69V7h7C76,7,76.1,1.7,76.1,1.7z M23.2,1.8v19.5h5.2V1.8C28.4,1.8,23.2,1.8,23.2,1.8z M30.8,1.8 v19.5h7.6l8.3-8.3V1.8h-5.2v8.3l-5.4,6V1.8C36.1,1.8,30.8,1.8,30.8,1.8z M49.1,1.8v19.5h5.2V1.8C54.3,1.8,49.1,1.8,49.1,1.8z"/>
                    <path fill="rgb(229, 231, 235)"
                          d="M100.3,1.8v19.5h5.2V1.8H100.3z M95.6,1.8H80.8l-2.3,2.3v17.2h5.2v-7.1h8.9v7.1h5.2V4.1C97.8,4.1,95.6,1.8,95.6,1.8z M92.7,8.9h-8.9V7h8.9V8.9z"/>
                    <path fill="url(#prideGradient)" d="M46.7,16.2v5.1h-5.1"/>
                </g>
            </svg>
        </a>
    </div>
</div>

<script>
  const FALLBACK_IMAGE = 'https://www.aloshy.ai/images/bg.png';
  const ROTATION_INTERVAL = 10000; // 10 seconds
  const FULLSCREEN_DELAY = 1000; // Delay before requesting fullscreen (1 second)

  // Add default parameters
  const DEFAULT_PARAMS = {
    limit: 100,
    nsfw: 'None',
    sort: 'Most Reactions',
    period: 'Month',
    page: 1
  };

  let imageCache = [];
  let currentImageIndex = 0;
  let backgrounds = document.querySelectorAll('.background');
  let activeIndex = 0;
  let isTransitioning = false;

  // Add function to parse URL parameters
  function getQueryParams() {
    const urlParams = new URLSearchParams(window.location.search);
    const params = {...DEFAULT_PARAMS};

    // Parse limit (ensure it's within 0-200)
    if (urlParams.has('limit')) {
      const limit = parseInt(urlParams.get('limit'));
      params.limit = Math.min(Math.max(0, limit), 200);
    }

    // Parse nsfw level - case insensitive
    if (urlParams.has('nsfw')) {
      const nsfw = urlParams.get('nsfw').toLowerCase();
      const validNsfw = {
        'none': 'None',
        'soft': 'Soft',
        'mature': 'Mature',
        'x': 'X'
      };
      if (validNsfw[nsfw]) {
        params.nsfw = validNsfw[nsfw];
      }
    }

    // Parse sort - case-insensitive
    if (urlParams.has('sort')) {
      const sort = urlParams.get('sort').toLowerCase();
      const validSort = {
        'most reactions': 'Most Reactions',
        'mostreactions': 'Most Reactions',
        'most comments': 'Most Comments',
        'mostcomments': 'Most Comments',
        'newest': 'Newest'
      };
      if (validSort[sort]) {
        params.sort = validSort[sort];
      }
    }

    // Parse period - case insensitive
    if (urlParams.has('period')) {
      const period = urlParams.get('period').toLowerCase();
      const validPeriod = {
        'alltime': 'AllTime',
        'year': 'Year',
        'month': 'Month',
        'week': 'Week',
        'day': 'Day'
      };
      if (validPeriod[period]) {
        params.period = validPeriod[period];
      }
    }

    // Parse page
    if (urlParams.has('page')) {
      const page = parseInt(urlParams.get('page'));
      if (page > 0) {
        params.page = page;
      }
    }

    return params;
  }

  async function fetchImageUrls() {
    try {
      const params = getQueryParams();
      const queryString = new URLSearchParams({
        limit: params.limit,
        nsfw: params.nsfw,
        sort: params.sort,
        period: params.period,
        page: params.page
      }).toString();

      const response = await fetch(`https://civitai.com/api/v1/images?${queryString}`, {
        headers: {'Content-Type': 'application/json'}
      });

      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

      const data = await response.json();
      return data.items || [];
    } catch (error) {
      console.warn('Error fetching images:', error);
      return null;
    }
  }

  async function preloadImage(url) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.onload = () => resolve(url);
      img.onerror = () => reject(new Error('Image load failed'));
      img.src = url;
    });
  }

  async function transition() {
    if (isTransitioning || imageCache.length === 0) return;

    try {
      isTransitioning = true;
      const nextIndex = (activeIndex + 1) % 2; // We have 2 background elements

      // Set the next image's source
      backgrounds[nextIndex].src = imageCache[currentImageIndex].url;

      // Wait a brief moment to ensure the image is loaded
      await new Promise(resolve => setTimeout(resolve, 100));

      // Perform the transition
      backgrounds[activeIndex].classList.remove('active');
      backgrounds[nextIndex].classList.add('active');

      // Update indices
      activeIndex = nextIndex;
      currentImageIndex = (currentImageIndex + 1) % imageCache.length;

      // Reset transitioning flag after animation completes
      setTimeout(() => {
        isTransitioning = false;
      }, 2000); // Match this with your CSS transition duration
    } catch (error) {
      console.warn('Error during transition:', error);
      isTransitioning = false;
    }
  }

  function showFallback() {
    backgrounds.forEach(bg => {
      bg.src = FALLBACK_IMAGE;
      bg.classList.remove('active');
    });
    backgrounds[0].classList.add('active');
  }

  async function requestFullscreen() {
    try {
      const elem = document.documentElement;
      if (elem.requestFullscreen) {
        await elem.requestFullscreen();
      } else if (elem.webkitRequestFullscreen) { // Safari
        await elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) { // IE11
        await elem.msRequestFullscreen();
      }
    } catch (error) {
      console.warn('Fullscreen request failed:', error);
    }
  }

  // Initialize
  (async () => {
    try {
      const fetchedImages = await fetchImageUrls();

      if (!fetchedImages || fetchedImages.length === 0) {
        showFallback();
        return;
      }

      imageCache = fetchedImages;

      // Set up first image
      backgrounds[0].src = imageCache[0].url;
      backgrounds[0].classList.add('active');
      currentImageIndex = 1;

      // Request fullscreen after a short delay
      setTimeout(requestFullscreen, FULLSCREEN_DELAY);

      // Start rotation
      setInterval(transition, ROTATION_INTERVAL);
    } catch (error) {
      console.warn('Error in initialization:', error);
      showFallback();
    }
  })();
</script>
</body>
</html>
